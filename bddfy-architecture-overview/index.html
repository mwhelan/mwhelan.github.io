
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="last-modified" content="2015-01-05T08:55:35.9545333+00:00" />
    <meta name="keywords" content="BDDfy,TestStack" />

    <title>Michael Whelan</title>

    <link href="/stylesheets/bootstrap.css" rel="stylesheet">
    <link href="/stylesheets/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/stylesheets/github.css" type="text/css">
    <link rel="stylesheet" href="/stylesheets/styles.css" type="text/css" />

    <link rel="canonical" href="http://www.michael-whelan.net/bddfy-architecture-overview/" />
</head>
<body>
    <div class="container">
        <!-- row 1: navigation -->
        <div class="row">
            <nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="navigation">
                <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="http://michael-whelan.net/">behaviour driven blog</a>
                    </div>
                    <div class="collapse navbar-collapse" id="collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="http://about.me/michaelwhelan">About</a></li>
                            <li class="dropdown">
                                <a href="#" data-toggle="dropdown">Categories <span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                        <li>
                                            <a href="/category/automated-testing" title="Automated Testing">Automated Testing</a>
                                        </li>
                                        <li>
                                            <a href="/category/azure" title="Azure">Azure</a>
                                        </li>
                                        <li>
                                            <a href="/category/bddfy" title="BDDfy">BDDfy</a>
                                        </li>
                                        <li>
                                            <a href="/category/black-box-testing-asp.net-series" title="Black-Box Testing ASP.Net Series">Black-Box Testing ASP.Net Series</a>
                                        </li>
                                        <li>
                                            <a href="/category/general" title="General">General</a>
                                        </li>
                                        <li>
                                            <a href="/category/learning" title="Learning">Learning</a>
                                        </li>
                                        <li>
                                            <a href="/category/programming" title="Programming">Programming</a>
                                        </li>
                                        <li>
                                            <a href="/category/seleno" title="Seleno">Seleno</a>
                                        </li>
                                        <li>
                                            <a href="/category/snow" title="Snow">Snow</a>
                                        </li>
                                        <li>
                                            <a href="/category/sql-server" title="SQL Server">SQL Server</a>
                                        </li>
                                        <li>
                                            <a href="/category/test-data" title="Test Data">Test Data</a>
                                        </li>
                                        <li>
                                            <a href="/category/teststack" title="TestStack">TestStack</a>
                                        </li>
                                        <li>
                                            <a href="/category/visual-studio" title="Visual Studio">Visual Studio</a>
                                        </li>
                                </ul>
                            </li>
                            <li><a href="/archive">Archive</a></li>
                            <li><a href="/feed.xml">RSS</a></li>
                        </ul>

                        <div class="navbar-right">
                            <a class="navbar-custom-button" href="https://twitter.com/mjmwhelan" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);"><img src="/stylesheets/images/twitter.png"></a>
                            <a class="navbar-custom-button" href="https://github.com/mwhelan" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://github.com']);"><img src="/stylesheets/images/github.png"></a>
                            <a class="navbar-custom-button" href="http://www.linkedin.com/in/mwhelan" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.linkedin.com']);"><img src="/stylesheets/images/linkedin.png"></a>
                            <a class="navbar-custom-button" href="https://plus.google.com/u/1/105055485720815974241?rel=me" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://plus.google.com']);"><img src="/stylesheets/images/googleplus.png"></a>
                        </div>
                    </div><!--collapse -->
                </div>
            </nav>
        </div><!--row -->
        <!-- row 2: header -->
        <header class="row">
            <a href="/" title="Home"><img width="60" height="60" src="http://www.gravatar.com/avatar/391e4f217a06e3dfc8976a4b99b79617.png" title="logo"></a>
            <h1 class="blog-title">
                <a href="/" title="Michael Whelan" rel="home">Michael Whelan</a>
            </h1>
            <p class="lead blog-description">behaviour driven blog</p>
        </header>

        <!-- row 3: featured -->
        <div class="row">
            
        </div>

        <!-- row 4: body -->
        <div class="row">
            

<div id="post">
    <h1 class="blog-post-title">BDDfy In Action: BDDfy Architecture Overview</h1>

    <div class="blog-post-meta">
        posted on 22 May 2013
            | <a class="label label-primary" href="/category/bddfy">BDDfy</a>
            | <a class="label label-primary" href="/category/teststack">TestStack</a>
    </div>

    <div class="blog-post">
        

        <p><strong>This article is part of the <a href="/bddfy-in-action/">BDDfy In Action</a> series.</strong></p>

<p>The rest of the articles in this series revolve around customizing and extending BDDfy. I thought it would be good to start with an overview of the main components of the BDDfy architecture to provide some context for that discussion and to illustrate the extensibility points.</p>

<p><img src="/images/bddfy-functional-decomposition.png" alt="" /> </p>

<p>The unit of operation in BDDfy is the Story. A Story has metadata (information about the Story) and a collection of Scenarios. Each Scenario represents a test class and contains metadata and a collection of Execution Steps, which are the methods on the test class. There are three types of architectural components in BDDfy: Scanners, Processors and Batch Processors. For each test class BDDfy composes a Story unit with various Scanners and passes it to the Processors in a processor pipeline. Once all of the test classes have been scanned and processed the Batch Processors run aggregate operations against all of the Stories.</p>

<p>Scanners turn a call to BDDfy (from a method) into a Scenario which could potentially be related to a Story. BDDfy doesn't need Stories but if there is one it uses it. If a Scenario is not related to a Story then it is associated with a dummy placeholder. Each Story is then passed to the Processors, which perform various operations, including executing the tests, and populate the Stories, Scenarios and Steps with the test execution results. Once all of the tests have been scanned and processed, the Batch Processors take the collection of Stories and process their results. This could be any sort of aggregate operation, but currently all the batch processors are reports.</p>

<h2>Scanners</h2>

<p>Most of the BDDfy in Action series so far has covered the various Scanners, so I won’t go into much detail here. Suffice to say, BDDfy uses Scanners to scan each test class to find all of the methods on it and turn the test class into a Scenario. The different Scanners are shown here:</p>

<p><img src="/images/bddfy-scanners.png" alt="" /></p>

<h3>Story Scanner</h3>

<p>BDDfy creates a Story Scanner for each test object. This is the Scanner that actually scans the test object and turns it into a Story. It composes together the Story Metadata Scanner and the appropriate Scenario Scanner – <a href="http://www.mehdi-khalili.com/bddify-in-action/fluent-api">Fluent</a> or <a href="http://www.mehdi-khalili.com/bddify-in-action/method-name-conventions">Reflective</a>. </p>

<p>The Story Metadata Scanner gets information from the Story attribute, if one exists on the class.</p>

<p>A <strong>Story</strong> has the following properties:</p>

<ul>
<li><strong>Story Metadata</strong>: Information about the Story such as Title, As a, I want, So that</li>
<li><strong>Scenarios</strong>: The collection of Scenarios related to the Story</li>
<li><strong>Result</strong>: A Story’s Result is a Step Execution Result and is determined by the highest Step Execution Result of its Scenarios. </li>
<li><strong>Category</strong>: The Story Category</li>
</ul>

<p><strong>Step Execution Results</strong> have a numerical hierarchy and can be (in ascending order):</p>

<ul>
<li>Not Executed (0)</li>
<li>Passed (1)</li>
<li>Not Implemented (2)</li>
<li>Inconclusive (3)</li>
<li>Failed (4)</li>
</ul>

<p>The Test Runner Processor assigns a numerical Step Execution Result to every Execution Step. The result of a Scenario is then determined by the highest value of from its Steps and the result of a Story is determined by the highest result of its Scenarios. For example, if a Step fails, then its parent Scenario and Story will also have a result of Failed.</p>

<h3>Scenario Scanners</h3>

<p>Scenario Scanners scan the test class and use the information they find to create a Scenario. There is a Fluent Scenario Scanner and a Reflective Scenario Scanner.</p>

<p>A <strong>Scenario</strong> has the following properties:</p>

<ul>
<li><strong>Title</strong>: The Scenario Title</li>
<li><strong>Steps</strong>: The collection of Steps (test class methods) related to the Scenario</li>
<li><strong>Result</strong>:   A Scenario’s Result is a Step Execution Result and is determined by the highest Step Execution Result of its Steps. </li>
<li><strong>Duration</strong>: How long the Scenario took to execute. Used by Diagnostics.</li>
</ul>

<h3>Step Scanners</h3>

<p>Step Scanners turn methods into Execution Steps. The Reflective Scanners (the Executable Attribute Step Scanner and the Method Name Scanner) scan the test class to find all the methods on it and turns them into Execution Steps. The Fluent Step Scanner is only a registry and in practice doesn't do any scanning.</p>

<p>An <strong>Execution Step</strong> has the following properties:</p>

<ul>
<li><strong>Title</strong>: The Step Title</li>
<li><strong>Result</strong>: The result of executing the Step. </li>
<li><strong>Duration</strong>: How long the Step took to execute. Used by Diagnostics.</li>
<li><strong>Asserts</strong>: Whether or not the Step is an Assertion Step.</li>
<li><strong>Should Report</strong>: Whether the Step should be displayed in reports.</li>
<li><strong>Execution Order</strong>: The order that the step should run in relative to the other steps. Can be (in ascending order) 
<ul>
<li>Initialize (for example, "Context", "Setup)</li>
<li>Setup State ("Given")</li>
<li>Consecutive Setup State ("And Given")</li>
<li>Transition ("When)</li>
<li>Consecutive Transition "And When")</li>
<li>Assertion ("Then")</li>
<li>Consecutive Assertion ("And Then")</li>
<li>Tear Down ("TearDown")
 
<h2>Processors</h2></li>
</ul></li>
</ul>

<p>Once a test class has been scanned into a Story, the Story is passed into a <strong>Processor pipeline</strong> where a series of processing steps are performed on it. The Processors are categorized by Type and the order they run in is determined by this Type.</p>

<p>The various <strong>Process Types</strong>, in order, are:</p>

<ol>
<li>Firstly</li>
<li>Execute</li>
<li>Before Report</li>
<li>Report</li>
<li>After Report </li>
<li>Process Exceptions</li>
<li>Finally</li>
</ol>

<p><img src="/images/bddfy-processor-pipeline.png" alt="BDDfy processor pipeline" /></p>

<ol>
<li><strong>Test Runner (Execute)</strong>: Executes the tests.</li>
<li><strong>Console Reporter (Report)</strong>: Displays the test result in the console.</li>
<li><strong>Exception Processor (Process Exceptions)</strong>:    Handles exceptions.</li>
<li><strong>Story Cache (Finally)</strong>: Saves each Story for later processing by the Batch Processors.</li>
<li><strong>Disposer   (Finally)</strong>: Cleans up the Story and its Scenarios.</li>
</ol>

<h2>Batch Processors</h2>

<p>Once all of the tests have been scanned and processed, the Batch Processors take all of the Stories and process their results (technically speaking they run in the <a href="http://msdn.microsoft.com/en-GB/library/system.appdomain.domainunload.aspx">AppDomain DomainUnload event</a>). This could be any sort of result processing, but currently all the batch processors are reports. The built-in Batch Processors are displayed in the diagram below.</p>

<p><img src="/images/bddfy-batch-processor-pipeline.png" alt="BDDfy batch processor pipeline" /></p>

<ul>
<li><strong>HTML Reporter</strong>: Creates the HTML report</li>
<li><strong>Markdown Reporter</strong>: Creates the Markdown report</li>
<li><strong>Diagnostics Reporter</strong>: Creates the Diagnostics report</li>
</ul>

<h2>Configurator</h2>

<p>The static Configurator class allows you to configure Scanners, Processors and Batch Processors. It lets you enable,  disable, or replace individual components and it also allows you to add custom implementations.</p>

    </div>
    
    <!-- Add this toolbox-->
    <div class="row addThis">
        <div class="addthis_toolbox addthis_default_style row pull-right" style="margin:10px">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
            <a class="addthis_button_linkedin_counter"></a>
            <a class="addthis_counter addthis_pill_style"></a>
        </div>
    </div>
    
    <!-- Disqus Comments -->
    <div class="row">
        <div id="disqus_thread"></div>
<script>
    var reset_disqus = function(){
        DISQUS.reset({
            reload: true,
            config: function () {
                //this.page.identifier = '';
                this.page.url = 'http://www.michael-whelan.net/bddfy-architecture-overview/';
                //this.page.title = '';
            }
        });
    };

    var disqus_shortname = 'givenwhenthen';
    var disqus_url = 'http://www.michael-whelan.net/bddfy-architecture-overview/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    window.addEventListener('orientationchange', reset_disqus);
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>        
    </div>
    
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53d54a0e28fe9235"></script>

    <!-- Authorship Google -->
    <a style="display: block; width: 30px; height: 30px; text-indent: -999px; text-decoration: none" href="https://plus.google.com/u/1/105055485720815974241?rel=author">Google</a>
</div>

        </div>

        <hr>

        <footer class="row">
            <p>&copy; 2014 - Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a>.</p>
        </footer>
    </div> <!-- /container -->
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/prettify.js"></script>

    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-49651944-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>

<script type='text/javascript'>
        $(function () {
            $("pre code").parent().each(function () {
                if (!$(this).hasClass("prettyprint")) {
                    $(this).addClass("prettyprint");
                    a = true
                }
            });

            prettyPrint();
        });
    </script>
    

    
    <!-- Authorship Google -->
    <a style="display: block; width: 30px; height: 30px; text-indent: -999px; text-decoration: none" href="https://plus.google.com/u/1/105055485720815974241?rel=author">Google</a>
</body>
</html>
